# JVMì—ì„œì˜ ë™ì‹œì„± ì œì–´ ë©”ì»¤ë‹ˆì¦˜

ìë°”(JVM)ëŠ” ì—¬ëŸ¬ ì‘ì—…(ìŠ¤ë ˆë“œ)ì´ ë™ì‹œì— ì‹¤í–‰ë  ë•Œ ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šë„ë¡ **'ëª¨ë‹ˆí„°(Monitor)'ë¼ëŠ” ì ê¸ˆ ì¥ì¹˜**ë¥¼ í™œìš©í•œë‹¤.  
ì‰½ê²Œ ë§í•´, **"í•˜ë‚˜ì”© ì°¨ë¡€ë¡œ ë“¤ì–´ê°€ê²Œ í•˜ì"** ë¼ëŠ” ê°œë…ì´ë‹¤.

---

## ë®¤í…ìŠ¤ (Mutex)

- **Mutual Exclusion = ìƒí˜¸ ë°°ì œ**
- ë™ì‹œì— **í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ìì›ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§‰ì•„ì£¼ëŠ” ì¥ì¹˜**

> í™”ì¥ì‹¤ì€ í•œ ëª…ì”©ë§Œ ì‚¬ìš© ê°€ëŠ¥. ë¬¸ì„ ì ê·¸ë©´ ë‹¤ë¥¸ ì‚¬ëŒì€ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤.

ìë°”ì˜ `synchronized`ëŠ” ì‚¬ì‹¤ ì´ ë®¤í…ìŠ¤ë¥¼ **ìë™ìœ¼ë¡œ** ì‚¬ìš©í•˜ëŠ” ë¬¸ë²•ì´ë‹¤.

---

## ì„¸ë§ˆí¬ì–´ (Semaphore)

- ë®¤í…ìŠ¤ë¥¼ **Nê°œë¡œ í™•ì¥í•œ ê²ƒ**
- ì˜ˆë¥¼ ë“¤ì–´, ë™ì‹œì— 5ëª…ê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ í—ˆìš©

> ì£¼ì°¨ì¥ì´ 5ì¹¸ì´ë©´, ì°¨ 5ëŒ€ê¹Œì§€ë§Œ ë“¤ì–´ì˜¬ ìˆ˜ ìˆê³ , ë‚˜ê°€ì•¼ ë‹¤ìŒ ì°¨ê°€ ë“¤ì–´ì˜¬ ìˆ˜ ìˆë‹¤.

```kotlin
val semaphore = Semaphore(5)

fun accessResource() {
    semaphore.acquire()   // ë“¤ì–´ê°€ê¸°
    try {
        // ìì› ì‚¬ìš©
    } finally {
        semaphore.release()  // ë‚˜ê°€ê¸°
    }
}
```

---

## ëª¨ë‹ˆí„° (Monitor)

- JVMì˜ ëª¨ë“  ê°ì²´ëŠ” **ëª¨ë‹ˆí„°ë¼ëŠ” ê¸°ëŠ¥**ì„ ê¸°ë³¸ìœ¼ë¡œ ê°–ê³  ìˆë‹¤
- ëª¨ë‹ˆí„°ëŠ” ì•„ë˜ ë‘ ê°€ì§€ ê¸°ëŠ¥ì„ í•œë‹¤:

```
ëª¨ë‹ˆí„° = ë®¤í…ìŠ¤(ì ê¸ˆì¥ì¹˜) + ì¡°ê±´ ê¸°ë‹¤ë¦¼(wait/notify)
```

### ì˜ˆë¥¼ ë“¤ë©´, í™”ì¥ì‹¤ + ëŒ€ê¸°ì¤„
- ë¬¸ì´ ì ê¸°ë©´ ë‹¤ë¥¸ ì‚¬ëŒì€ ê¸°ë‹¤ë¦¼ (`lock`)
- ì–´ë–¤ ì¡°ê±´ì´ ì¶©ì¡±ë˜ë©´ ë‹¤ìŒ ì‚¬ëŒì„ ë¶ˆëŸ¬ì¤Œ (`notify`)

```java
synchronized(obj) {
    while (!ì¡°ê±´) {
        obj.wait();     // ì¡°ê±´ì„ ê¸°ë‹¤ë¦¼
    }
    // ì¡°ê±´ ì¶©ì¡±ë¨ -> ì‘ì—… ì‹¤í–‰
    obj.notify();       // ë‹¤ë¥¸ ì‚¬ëŒ ë¶ˆëŸ¬ì¤Œ
}
```

---

## JVMê³¼ `synchronized`ëŠ” ì–´ë–¤ ê´€ê³„ ì¼ê¹Œ

`synchronized(obj)`ëŠ”  
-> **objì˜ "ëª¨ë‹ˆí„°"ë¥¼ ì–»ì–´ì•¼ë§Œ** ì‹¤í–‰ ê°€ëŠ¥í•˜ë‹¤.

```java
synchronized(obj) {
    // objì˜ ë¬¸ì„ ì ê¶ˆì•¼ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤
}
```

JVM ë‚´ë¶€ì—ì„œëŠ” ë‹¤ìŒì²˜ëŸ¼ ì²˜ë¦¬ëœë‹¤:

| ë°”ì´íŠ¸ì½”ë“œ ëª…ë ¹ì–´ | ì˜ë¯¸                    |
|------------------|-------------------------|
| `monitorenter`   | ëª¨ë‹ˆí„°(ë½) íšë“         |
| `monitorexit`    | ëª¨ë‹ˆí„°(ë½) í•´ì œ         |

---

## â˜• Kotlinì˜ @Synchronized

```kotlin
@Synchronized
fun criticalSection() {
    // í•œ ìŠ¤ë ˆë“œë§Œ ì ‘ê·¼ ê°€ëŠ¥
}
```

-> Java ì½”ë“œë¡œ ë³´ë©´ ì•„ë˜ì™€ ê°™ìŒ:

```java
public synchronized void criticalSection() {
    // ...
}
```

ğŸ›‘ ë‹¨ì :
- í•¨ìˆ˜ ì „ì²´ì— ë½ì´ ê±¸ë¦¼ (ë„ˆë¬´ í° ë²”ìœ„)
- ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ëª» ë“¤ì–´ì™€ì„œ ì„±ëŠ¥ ë–¨ì–´ì§

---

## ì„±ëŠ¥ ê°œì„  ë°©ë²•

### ë°©ë²• 1: ì§„ì§œ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì êµ¬ê¸°

```kotlin
fun doWork(data: String) {
    val result = data.uppercase()  // ì´ê±´ ë½ í•„ìš” ì—†ìŒ

    synchronized(this) {
        sharedList.add(result)     // ì´ ë¶€ë¶„ë§Œ ì ê¸ˆ
    }
}
```

---

### ë°©ë²• 2: ë” ë˜‘ë˜‘í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¥¼ ì¨ë³´ì.

#### ReentrantLock
```kotlin
val lock = ReentrantLock()

lock.lock()
try {
    // ìì› ì‚¬ìš©
} finally {
    lock.unlock()
}
```

#### AtomicInteger (ìˆ«ìì— íŠ¹í™”ëœ ë½ ì—†ëŠ” ë„êµ¬)

```kotlin
val counter = AtomicInteger(0)

fun increment() = counter.incrementAndGet()
```

#### ConcurrentHashMap

```kotlin
val map = ConcurrentHashMap<String, Int>()

map["user"] = 10
```

- ë‚´ë¶€ì ìœ¼ë¡œ ë½ì„ ì˜ê²Œ ìª¼ê°œì„œ ì²˜ë¦¬í•˜ë‹ˆ, í›¨ì”¬ ë¹ ë¥´ë‹¤.

---

## ì–¸ì œ ì–´ë–¤ ê±¸ ì¨ì•¼ í• ê¹Œ?

| ìƒí™©                         | ì¶”ì²œ ë„êµ¬                              |
|----------------------------|----------------------------------------|
| ë‹¨ìˆœí•˜ê²Œ ì ê·¸ê³  ì‹¶ì„ ë•Œ         | `@Synchronized`, `synchronized`       |
| ê³µìœ  ë§µ/ë¦¬ìŠ¤íŠ¸ë¥¼ ì“¸ ë•Œ          | `ConcurrentHashMap`, `CopyOnWrite...` |
| ë½ì„ ì„¸ë°€í•˜ê²Œ ì œì–´í•˜ê³  ì‹¶ì„ ë•Œ   | `ReentrantLock`, `ReadWriteLock`      |
| ìˆ«ìë‚˜ ë¶ˆë¦° ê°’ë§Œ ë°”ê¿€ ë•Œ         | `AtomicInteger`, `AtomicBoolean`      |

---

## ì •ë¦¬

- ìë°”ëŠ” **ê°ì²´ë§ˆë‹¤ ëª¨ë‹ˆí„°**ë¼ëŠ” ë½+ì¡°ê±´ ê¸°ëŠ¥ì„ ê¸°ë³¸ ì œê³µí•œë‹¤.
- `synchronized`ëŠ” ê·¸ ëª¨ë‹ˆí„°ë¥¼ ì ê·¸ëŠ” ë¬¸ë²•ì´ë‹¤.
- ë” ë¹ ë¥´ê³  ìœ ì—°í•˜ê²Œ í•˜ê³  ì‹¶ë‹¤ë©´, **concurrent ë„êµ¬ë“¤**ì„ í™œìš©