## ë“¤ì–´ê°€ë©°

í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ ê¸°ë°˜ìœ¼ë¡œ ì‹œì‘í•´ í”„ë¡œì íŠ¸ ë¼ˆëŒ€ë¥¼ ì¡ì€ì§€ ì–´ëŠë§ 1ë‹¬ì´ ë˜ì–´ê°„ë‹¤.  

ê·¸ëŸ¬ë‹¤ í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ì™€ DDD ë°©ë²•ë¡ ì„ ì ìš©í•´ ë©€í‹°ëª¨ë“ˆ êµ¬ì¡°ë¡œ í™•ì¥í–ˆê³ , ê·¸ ê³¼ì •ì—ì„œ ê³µí†µ ì‘ë‹µì½”ë“œ ì„¤ê³„ë¥¼ í•˜ë©´ì„œ ë§ì€ ê³ ë¯¼ì„ í•˜ê²Œ ë˜ì—ˆë‹¤.

ë‹¨ìˆœíˆ ì½”ë“œë¥¼ ë‚˜ëˆ„ëŠ” ë¬¸ì œê°€ ì•„ë‹ˆë¼, ëª¨ë“ˆ ê°„ ì˜ì¡´ì„±ì„ ì •ë¦¬í•˜ê²Œ ë˜ì—ˆê³  ë„ë©”ì¸ ìˆœìˆ˜ì„±ì„ ì§€í‚¤ë©´ì„œ, íŒ€ ì „ì²´ê°€ ë”°ë¼ì•¼ í•  ê·œì¹™ì„ ì½”ë“œë¡œ ê°•ì œí•˜ëŠ” ê³¼ì •ì„ ê²½í—˜í•˜ë‹ˆ

â€œìœ ì§€ë³´ìˆ˜ë¥¼ ìµœì í™”í•˜ëŠ” ì „ëµâ€ì´ë¼ëŠ” ë§ì´ ì¶”ìƒì ìœ¼ë¡œ ë“¤ë ¸ëŠ”ë°, ì§ì ‘ êµ¬í˜„í•˜ë‹ˆ ì™œ ê·¸ê²Œ ë°©íŒŒì œ ì—­í• ì„ í•˜ëŠ”ì§€ í”¼ë¶€ë¡œ ëŠê»´ì¡Œë‹¤.

ê·œì¹™ê³¼ ì œì•½ì€ ë§ì•„ì¡Œì§€ë§Œ, ê·¸ê²Œ ì—†ìœ¼ë©´ êµ¬ì¡°ëŠ” ì–¸ì  ê°€ ë¬´ë„ˆì§„ë‹¤.

íŠ¹íˆ ë©€í‹°ëª¨ë“ˆ í™˜ê²½ì—ì„œ ì»¨ë²¤ì…˜ì„ ì§€í‚¤ê³ , ê³µí†µ ì½”ë“œë¥¼ ì¼ê´€ë˜ê²Œ ìœ ì§€í•˜ëŠ” ì¼ì€ íŒ€ ìƒì‚°ì„±ê³¼ ë¹„ìš©ì— ë§ì€ ì˜í–¥ì„ ì¤€ë‹¤.

ì†ë„ë§Œ ë³´ë‹¤ê°€ êµ¬ì¡°ë¥¼ ì„¸ìš°ê¸° ìœ„í•œ ë†’ì€ ìš´ì˜ë¹„ìš©ì„ ê²½í—˜í•˜ì‹  ê°œë°œìë“¤ì„ ì—¬ëŸ¬ ë²ˆ ë´¤ê¸°ì—, ì´ë²ˆì—” ì²˜ìŒë¶€í„° â€˜ë°©íŒŒì œâ€™ë¥¼ ì„¸ìš°ê³  ì‹¶ì—ˆë‹¤.

ì§€ê¸ˆì˜ ì‹œë„ëŠ” ë‹¨ìˆœí•œ ì„¤ê³„ ì—°ìŠµì´ ì•„ë‹ˆë¼, ë¯¸ë˜ ìœ ì§€ë³´ìˆ˜ ë¹„ìš©ì„ ì¤„ì´ê¸° ìœ„í•œ ì„ ë¶ˆ ë¹„ìš©ì´ë¼ ìƒê°í•˜ê³  ì •ë¦¬í•´ë³´ì.

> íŒ€ë§ˆë‹¤ / ìš´ì˜ í™˜ê²½ì— ë”°ë¼, instance ë¥¼ ì˜¬ë¦¬ëŠ” ìƒí™© ì´ ë°œìƒí•˜ê²Œ ë˜ë©´ ìš´ì˜ cost ê°€ ì˜¬ë¼ê°€ê²Œ ëœë‹¤.   
> 
> ì–´ëŠì •ë„ ì¤‘ë³µì„ í—ˆìš©í•˜ëŠ”ê²ƒ + domain ( application ì— common ì„ ë‘ê³  ì‘ì—… )  
> ì‚¬ëŒì— ë”°ë¼ì„œ (ìš´ìš© ëŠ¥ë ¥) ì´ ê°ˆë¦¬ê²Œ ë˜ë‹ˆ. 
> 
> ê²½í—˜ì„ ê¸°ë°˜í•œ ìµœì„ ì˜ ì„ íƒì´ ê²°êµ­ ë‚¨ë“¤ì´ ë³´ì•˜ì„ë•Œë„ ë‚©ë“ì´ ê°€ì•¼ëœë‹¤.   
> 
> ë‚˜ì•„ê°€ì„œ It shake it ì¢€ ì¹˜ëŠ”ë°... ë¼ëŠ” ë§ì„ ë“¤ìœ¼ë©´ ë” ì¢‹ê³  ( ìµœê³ ì˜ ì„±ì·¨ ë„íŒŒë¯¼ )   

# í—¥ì‚¬ê³ ë‚  + DDD ìš´ì˜ ë§¤ë‰´ì–¼ì„ ì¡ëŠ”ë‹¤ë©´.

## ì² í•™ê³¼ ë°©í–¥ì„± ì¸¡ë©´

> **â€œí—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ + DDD = ë³€ê²½ ê´€ë¦¬ ì „ëµì´ë‹¤â€**  
> ì„¤ê³„ì˜ ëª©ì ì€ êµ¬ì¡°ë¥¼ ì´ì˜ê²Œ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ë³€ê²½ ë¹„ìš©ê³¼ ë¦¬ìŠ¤í¬ë¥¼ ìµœì†Œí™”**í•˜ëŠ” ê²ƒì´ë‹¤.

ì²´í¬ë¦¬ìŠ¤íŠ¸ ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤
- [ ] ìœ ì§€ë³´ìˆ˜ / í™•ì¥ì— ìµœì  ?
- [ ] ë³€ê²½ ì˜í–¥ ë²”ìœ„ê°€ ì˜ˆì¸¡ ê°€ëŠ¥ ? <strike>(ì´ê±° ì†”ì§íˆ ì‹  ì•„ë‹ˆë©´ ì•„ë¬´ë„ ëª¨ë¥´ì§€ ì•Šë‚˜ ..? )</strike>
- [ ] ë„ë©”ì¸ ëª¨ë¸ì˜ ìˆœìˆ˜ì„±ì´ ë³´ì¡´ ë˜ëŠ”ê°€ ?
- [ ] ì¸í”„ë¼ / ì „ë‹¬ ë ˆì´ì–´ ê¸°ìˆ  êµì²´ì— ìœ ì—° í•˜ëŠ”ê°€ ?
- [ ] íŒ€ ê°„ ì˜ì‚¬ì†Œí†µ ë¹„ìš© ìµœì†Œí™” <strike>(ì´ê²ƒë„ ì†”ì§íˆ ì‚¬ëŒ ì˜ ëª» ë§Œë‚˜ë©´ ì§€ì˜¥ ì•„ë‹Œê°€ ? )</strike>

> ì •ì •.. ë³€ê²½ ì˜í–¥ ë²”ìœ„ê°€ ì˜ˆì¸¡ ë˜ë ¤ë©´ ì‚¬ì‹¤ ì•„ë¹ ê°€ ì´ì¬ã….. ì´ì—¬ë„ í˜ë“¤ ìì.. 
---

## ëª¨ë“ˆ êµ¬ì¡°

```
:common-domain           # ê³µí†µ ë„ë©”ì¸ ì˜¤ë¥˜ ëª¨ë¸ (Spring) [X]
:common-application           # ì „ì—­ ì˜ˆì™¸ í•¸ë“¤ëŸ¬, ErrorResponse (Spring Web) [V]

:transfer-domain         # ë„ë©”ì¸ ì—”í‹°í‹°/ì •ì±…
:transfer-application    # ìœ ìŠ¤ì¼€ì´ìŠ¤/íŠ¸ëœì­ì…˜ (Web ëª¨ë¦„)
:transfer-infra          # RDB/Kafka/ì™¸ë¶€ API ì–´ëŒ‘í„°

:api                     # HTTP ì—”ë“œí¬ì¸íŠ¸ (Controller)
```

---

## 3. ì˜ì¡´ì„± ê·œì¹™

| From \ To            | common-domain | common-application | transfer-domain | transfer-application | transfer-infra |     api |
|----------------------|--------------:|--------------------:|----------------:|---------------------:|---------------:|--------:|
| common-domain        |             â€” |                ğŸ™…ğŸ» |            ğŸ™…ğŸ» |                 ğŸ™…ğŸ» |           ğŸ™…ğŸ» |    ğŸ™…ğŸ» |
| common-application  |       ğŸ™†ğŸ»â€â™€ï¸ |                   â€” |            ğŸ™…ğŸ» |                 ğŸ™…ğŸ» |           ğŸ™…ğŸ» | ğŸ™†ğŸ»â€â™€ï¸ |
| transfer-domain      |       ğŸ™†ğŸ»â€â™€ï¸ |                ğŸ™…ğŸ» |               â€” |                 ğŸ™…ğŸ» |           ğŸ™…ğŸ» |    ğŸ™…ğŸ» |
| transfer-application |       ğŸ™†ğŸ»â€â™€ï¸ |                ğŸ™…ğŸ» |         ğŸ™†ğŸ»â€â™€ï¸ |                    â€” |        ğŸ™†ğŸ»â€â™€ï¸ |    ğŸ™…ğŸ» |
| transfer-infra       |       ğŸ™†ğŸ»â€â™€ï¸ |                ğŸ™…ğŸ» |         ğŸ™†ğŸ»â€â™€ï¸ |              ğŸ™†ğŸ»â€â™€ï¸ |              â€” |    ğŸ™…ğŸ» |
| api                  |       ğŸ™†ğŸ»â€â™€ï¸ |             ğŸ™†ğŸ»â€â™€ï¸ |         ğŸ™†ğŸ»â€â™€ï¸ |              ğŸ™†ğŸ»â€â™€ï¸ |        ğŸ™†ğŸ»â€â™€ï¸ |       â€” |

- **application -> web ì˜ì¡´ ë¶ˆê°€ëŠ¥**
- **api ë§Œ** web ì˜ì¡´ ê°€ëŠ¥
- **shared-* ëŠ” Spring ì˜ì¡´ X*

---

## ë ˆì´ì–´ ì±…ì„

### Domain

- ë„ë©”ì¸ ì—”í‹°í‹°, ê°’ ê°ì²´, ì• ê·¸ë¦¬ê²Œì‡, ì •ì±…
- ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
- **ì™¸ë¶€ ê¸°ìˆ /ì „ë‹¬ìˆ˜ë‹¨ ëª¨ë¦„**

### Application

- ìœ ìŠ¤ì¼€ì´ìŠ¤(ì„œë¹„ìŠ¤)
- íŠ¸ëœì­ì…˜ ê²½ê³„
- í¬íŠ¸ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- **HttpStatus/ResponseEntity ëª¨ë¦„**

### Infrastructure

- í¬íŠ¸ êµ¬í˜„ì²´ (RDB, Kafka, ì™¸ë¶€ API)
- ì¸í”„ë¼ ì˜ˆì™¸ â†’ ë„ë©”ì¸ ì˜¤ë¥˜ ë³€í™˜
- ê¸°ìˆ  ìŠ¤íƒ ì˜ì¡´ í—ˆìš©

### Delivery(API)

- ì»¨íŠ¸ë¡¤ëŸ¬
- ì „ì—­ ì˜ˆì™¸ í•¸ë“¤ëŸ¬
- ë„ë©”ì¸ ì˜¤ë¥˜ â†’ HTTP ì‘ë‹µ ë§¤í•‘

---

## ì˜ˆì™¸/ì˜¤ë¥˜ ì²˜ë¦¬

### ê³µí†µ ë„ë©”ì¸ ì˜¤ë¥˜ (`common-domain`)

```kotlin
sealed interface DomainError {
    val code: String
    val message: String
    val meta: Map<String, Any?> get() = emptyMap()
}

class DomainException(val error: DomainError) : RuntimeException(error.message)
```

### ê³µí†µ ì˜¤ë¥˜ ì˜ˆì‹œ

```kotlin
sealed interface CommonError : DomainError {
    data class NotFound(val resource: String, val id: String) : CommonError { ... }
    data class InvalidArgument(val field: String, val reason: String?) : CommonError { ... }
    object Timeout : CommonError { ... }
    data class Conflict(val reason: String) : CommonError { ... }
    data class ExternalDependencyError(val service: String, val detail: String?) : CommonError { ... }
}
```

### ë„ë©”ì¸ ì „ìš© ì˜¤ë¥˜ ì˜ˆì‹œ (`transfer-domain`)

```kotlin
sealed interface TransferError : DomainError
data class InsufficientBalance(val current: Long, val request: Long) : TransferError { ... }
```

---

## ì¸í”„ë¼ ì˜ˆì™¸ ë³€í™˜ (`safeDbCall`)

```kotlin
inline fun <T> safeDbCall(block: () -> T): T =
    try {
        block()
    } catch (t: Throwable) {
        val err = InfraErrorTranslator.translate(t) ?: throw t
        throw DomainException(err, t)
    }
```

Spring/JPA ì˜ˆì™¸ ë§¤í•‘ ë“±ë¡:

```kotlin
@Configuration
class InfraErrorSpringRules {
    init {
        InfraErrorTranslator.register { t ->
            when (t) {
                is EmptyResultDataAccessException -> CommonError.NotFound("unknown", "unknown-id")
                is DataIntegrityViolationException -> CommonError.Conflict("duplicate-key")
                is QueryTimeoutException -> CommonError.Timeout
                is CannotCreateTransactionException -> CommonError.ExternalDependencyError("rdb", t.message)
                else -> null
            }
        }
    }
}
```

---

## ì˜ì¡´ì„± ê°•ì œ ë„êµ¬

- **Gradle ìŠ¤í¬ë¦½íŠ¸**: í—ˆìš© ë§¤íŠ¸ë¦­ìŠ¤ ìœ„ë°˜ ì‹œ ë¹Œë“œ ì‹¤íŒ¨
- **ArchUnit**: ë ˆì´ì–´ ê°„ ê¸ˆì§€ ì˜ì¡´ì„± í…ŒìŠ¤íŠ¸ì—ì„œ ì°¨ë‹¨
- **Version Catalog**: ë²„ì „ ì¤‘ì•™í™”
- **Convention Plugin**: ê³µí†µ Kotlin/Spring ì„¤ì • ì ìš©

---

## ì˜¨ë³´ë”© ê°€ì´ë“œ

1. ìƒˆ ë„ë©”ì¸ ìƒì„± ì‹œ `*-domain` / `*-application` / `*-infra` ëª¨ë“ˆ ìƒì„±
2. í¬íŠ¸ ì¸í„°í˜ì´ìŠ¤(application) â†’ ì–´ëŒ‘í„° êµ¬í˜„(infra)
3. ì˜¤ë¥˜ëŠ” DomainError ìƒì†
4. API ê³„ì¸µì—ì„œ DomainExceptionì„ HTTPë¡œ ë§¤í•‘
5. infraëŠ” `safeDbCall` ì‚¬ìš©í•˜ì—¬ ì˜ˆì™¸ ë³€í™˜

---

## íŒ

- ê·œì¹™ì€ ë°˜ë“œì‹œ **ì½”ë“œë¡œ ê°•ì œ** -> ë§ë¡œë§Œ í•˜ë©´ ê¹¨ì§
- ìƒˆ ëª¨ë“ˆ ì¶”ê°€ ì‹œ **ì˜ì¡´ ë§¤íŠ¸ë¦­ìŠ¤ í‘œ**ì— ë°˜ì˜
- ì „ì—­ ì˜ˆì™¸ ë³€í™˜ ê·œì¹™ì€ í•œ ê³³ì—ì„œë§Œ ìˆ˜ì •
- ìƒ˜í”Œ/í…œí”Œë¦¿ ëª¨ë“ˆì„ ë§Œë“¤ì–´ ì‹ ê·œ ê°œë°œìëŠ” ê·¸ëŒ€ë¡œ ë³µë¶™ ì‹œì‘
- Event Driven ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ë²¤íŠ¸ ë„¤ì´ë°/ìŠ¤í‚¤ë§ˆ ë²„ì „ ê´€ë¦¬ ê·œì¹™ ì¶”ê°€
