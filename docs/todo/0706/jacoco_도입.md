# ìµœê·¼ ì½”ë“œ í’ˆì§ˆì— ëŒ€í•œ ê³ ë¯¼

## ë°”ìœ ì‹¤ë¬´, ì ì  ì¤„ì–´ë“œëŠ” ì‚¬ëŒ ë¦¬ë·°

ìš”ì¦˜ ê°œë°œìë“¤ì˜ í˜„ì‹¤ì€... ì‚¬ë°”ì‚¬ ë¼ì§€ë§Œ **ëŒ€ë¶€ë¶„ ì •ë§ ë°”ì˜ë‹¤**. ğŸ¤¦â€â™‚ï¸   
ì½”ë“œë¦¬ë·° ë¬¸í™”ê°€ ì •ì°©ë˜ì–´ ìˆë‹¤ í•˜ë”ë¼ë„, ì‚¬ì‹¤ìƒ **ë¦¬ë·° ìì²´ê°€ í˜•ì‹ì ìœ¼ë¡œ íë¥´ê±°ë‚˜ ìƒëµë˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤**.  
ì§€ì¸ë“¤ë§Œ ë´ë„ ì•„ë˜ì™€ ê°™ë‹¤:

- A: "ì˜ˆì „ì—” íƒ€ íŒ€ ì½”ë“œë„ ë³´ê³ , ë¦¬ë·°ë„ ë§ì´ í–ˆëŠ”ë° ì´ì œëŠ”... ê± ìê¸° ì¼ í•˜ê¸°ë„ ë²…ì°¨ë‹¤."
- B: "ì»¤ë²„ë¦¬ì§€ ë„êµ¬? Jacoco ì¨. GPTë¡œ ë¦¬ë·°ë„ ì¢…ì¢… í•˜ì§€."
- C: "ì•¼ ì‚´ë ¤ì¤˜.."
- D: "ì´ê²Œ íšŒì‚¬ëƒ...í‡´ì‚¬í•˜ê³  ì‹¶ë‹¤." ( ì–œ ì¢€ ì‹¬ê°í•œ ê²ƒ ê°™ë‹¤. )

ì‹¬ì§€ì–´ ë„ˆë¬´ ë°”ìœ ë‚˜ë¨¸ì§€, ì¹´ì¹´ì˜¤í†¡ ìƒíƒœë©”ì‹œì§€ê°€ `ì¹´í†¡ í˜ë“¤ì–´ìš”, ë¬¸ì ì£¼ì„¸ìš”`ì¸ ì§€ì¸ë„ ìˆë‹¤. ğŸ˜…   

ë•Œë¬¸ì—, í˜•ì‹ì  ë¦¬ë·°ê°€ ë§ì•„ì§€ê³  ì‚¬ëŒ ë¦¬ì†ŒìŠ¤ê°€ ì¤„ì–´ë“œëŠ” ìš”ì¦˜ì—” ë‹¤ìŒ ì˜ì—­ë“¤ì´ **ì´ë¯¸ AIë‚˜ ìë™í™”ë¡œ ë„˜ì–´ê°”ë‹¤ê³  ë³¸ë‹¤.**

- ë¦¬í™í† ë§ êµ¬ì¡° ì œì•ˆ
- ë„¤ì´ë° í”¼ë“œë°±
- í•¨ìˆ˜ ë¶„ë¦¬ íŒë‹¨

### ê·¸ë ‡ë‹¤ë©´ True ë©˜í† ë‹˜ì´ ì–¸ê¸‰ ì£¼ì‹  í’ˆì§ˆ ì²´í¬ëŠ” ë¬´ì—‡ì¼ê¹Œ?

> **ìë™í™” ê°€ëŠ¥í•œ í’ˆì§ˆ ê²€ì¦** ì˜ì—­ì´ë‹¤.  
ì˜ˆë¥¼ ë“¤ì–´ Jacocoë¥¼ í™œìš©í•œ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ì²´í¬ê°€ ë  ìˆ˜ ìˆê² ë‹¤.

---

## Jacoco (Java Code Coverage) ë€?
ë¶€ë„ëŸ½ì§€ë§Œ, ì²˜ìŒë“¤ì–´ ë´¤ë‹¤. ( ì½”ì½”ì•„ê°€ ë¨¹ê³ ì‹¶ë‹¤ )
> Java ë° Kotlinì—ì„œ ë„ë¦¬ ì“°ì´ëŠ” **ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ì¸¡ì • ë„êµ¬**  

- í…ŒìŠ¤íŠ¸ê°€ ì‹¤ì œ ì½”ë“œì˜ ì–´ëŠ ë¶€ë¶„ì„ ì‹¤í–‰í–ˆëŠ”ì§€, ì–´ëŠ ë¼ì¸ì´ ë¹„ì–´ ìˆëŠ”ì§€ë¥¼ ì•Œë ¤ì¤€ë‹¤.
- Gradle/Mavenê³¼ ì‰½ê²Œ í†µí•© ê°€ëŠ¥í•˜ë©° HTML, XML, CSV ë“±ì˜ ë¦¬í¬íŠ¸ë¡œ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.
- íŒ€/í”„ë¡œì íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì¹˜ ê¸°ë°˜ í’ˆì§ˆ ê¸°ì¤€ ì„¤ì •ë„ ê°€ëŠ¥í•˜ë‹¤.
  - ì „ì²´ LINE ì»¤ë²„ë¦¬ì§€ â‰¥ 80% 
  - ì „ì²´ BRANCH ì»¤ë²„ë¦¬ì§€ â‰¥ 70%

> ì—¥ ... JacocoëŠ” ì•µê°„í•˜ë©´, **ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •ì˜ í‘œì¤€**ìœ¼ë¡œ ìë¦¬ ì¡ì•˜ë‹¤ ë´ë„ ë¬´ë°©í• ë“¯ ì‹¶ë‹¤.
---

## 4. Jacoco + ì—°ë™ ëŒ€ìƒ ë¹„êµ

| ì—°ë™ ëŒ€ìƒ           | íŠ¹ì§• ë° ìš©ë„                            | ì»¤ë²„ë¦¬ì§€ ì‹œê°í™”         | PR ì½”ë©˜íŠ¸ ì§€ì› | ê¸°íƒ€ ë¶„ì„ ê¸°ëŠ¥                      |
|--------------------|----------------------------------------|--------------------------|----------------|--------------------------------------|
| **Codecov**      | **ê°€ë³ê³  ì‰¬ì›€** <br> GitHub Actionsì™€ ì°°ë–¡ | ì›¹/ë±ƒì§€/ë¼ì¸ë³„ í‘œì‹œ      | ìë™ ì½”ë©˜íŠ¸     |  ì»¤ë²„ë¦¬ì§€ ì™¸ í’ˆì§ˆ ë¶„ì„ ì—†ìŒ             |
| **SonarQube**    | **ì •ë°€ í’ˆì§ˆ ë¶„ì„ìš©** <br> ë³´ì•ˆ/ìŠ¤ë©œ/ì¤‘ë³µ ì²´í¬ |  Dashboard UI ê¸°ë°˜       | ê¸°ë³¸ ë¯¸ì§€ì›     | ì •ì  ë¶„ì„, ë³´ì•ˆ ì´ìŠˆ, ìŠ¤ë©œ ë“± í¬í•¨     |

> ê°œì¸ í”„ë¡œì íŠ¸ë‚˜ ë¹ ë¥¸ í”¼ë“œë°±ì´ í•„ìš”í•œ ê²½ìš°ì—” Codecov  
> íŒ€ í˜‘ì—…, í’ˆì§ˆ ê²Œì´íŠ¸/ë³´ì•ˆê¹Œì§€ ì±™ê¸°ë ¤ë©´ SonarQubeì™€ ì—°ë™

---

## ì–´ë–¤ êµ¬ì„±ìœ¼ë¡œ ìµœê³  ë² ìŠ¤íŠ¸ ì¼ê¹Œ ?

ë©˜í† ë‹˜ ê³¼ì œëŠ” ë‹¨ìˆœíˆ Jacoco ì—°ë™ì´ ì•„ë‹ˆë¼, **ì‹¤ì œ ì„œë¹„ìŠ¤ ì½”ë“œì˜ í’ˆì§ˆì„ ì§€í‚¤ê¸° ìœ„í•œ ì „ì²´ íë¦„ì„ êµ¬ì„±í•´ë³´ëŠ” ê²ƒ**ìœ¼ë¡œ ì´í•´í–ˆë‹¤.

| êµ¬ì„± ìš”ì†Œ                    | ì„¤ëª…                                                                       |
|-----------------------------|--------------------------------------------------------------------------|
| **Gradle ë¹Œë“œ**             | ê¸°ë³¸ ë¹Œë“œ + í…ŒìŠ¤íŠ¸ task                                                         |
| **Jacoco ì ìš©**             | `test` task ì´í›„ `jacocoTestReport` ë¥¼`jacocoTestCoverageVerification` ë¡œ ì—°ê²° |
| **Coverage ê¸°ì¤€ ì„¤ì •**       | `LINE â‰¥ 80%`, `BRANCH â‰¥ 70%` ë“± ëª…ì‹œ í›„ Fail ì¡°ê±´ ì„¤ì •                           |
| **SonarQube ì—°ë™ (ì„ íƒ)**   | ì¤‘ë³µ/ìŠ¤ë©œ ë“± ì •ì  ë¶„ì„ê¹Œì§€ ì¶”ê°€                                                       |
| **ì·¨ì•½ì  ê°ì§€ (OWASP ë“±)**  | `dependencyCheck` ë˜ëŠ” `snyk` ë“±ìœ¼ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³´ì•ˆ í™•ì¸ (log4j ì‚¬íƒœ ë“±..)               |
| **CI ì—°ë™**                | GitHub Actions ë“±ìœ¼ë¡œ PR ì‹œ ìë™ ì‹¤í–‰, ë°°ì§€ + ë¦¬í¬íŠ¸ ì½”ë©˜íŠ¸                              

---

## ê²°ë¡  ì ìœ¼ë¡œ

- **ì½”ë“œë¦¬ë·°ëŠ” ë” ì´ìƒ ì¸ê°„ì˜ ëˆˆì—ë§Œ ì˜ì¡´í•  ìˆ˜ ì—†ë‹¤.**
- ê·¸ë˜ì„œ **ì»¤ë²„ë¦¬ì§€ ë„êµ¬ + ì •ì  ë¶„ì„ + ì·¨ì•½ì  íƒì§€**ë¥¼ í†µí•´ **ê°ê´€ì  í’ˆì§ˆ ì§€í‘œ**ë¥¼ í™•ë³´í•´ì•¼ í•œë‹¤.
- **ë¹ ë¥´ê³  ë¯¿ì„ ìˆ˜ ìˆëŠ” í’ˆì§ˆ ë³´ì¦** 

> Jacoco ì ìš©í•˜ë©´ PRì— ì»¤ë²„ë¦¬ì§€ ë±ƒì§€ê°€ ë¶™ëŠ”ë‹¤ë˜ë°, í’ˆì§ˆ ì‹ ë¢°ë„ê°€ ì˜¬ë¼ê°€ëŠ” ê²ƒì„ ì²´ê°í•´ ë´ì•¼ê² ë‹¤.

---

## jacoco Gradle ì„¤ì •

```kotlin
import org.jetbrains.kotlin.gradle.tasks.KotlinCompile

plugins {
  ....
  id("jacoco") // ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •
}

group = "io.github.hyungkishin"
version = "0.0.1-SNAPSHOT"

/**
 * Coverage ì •ì±…
 * - LINE â‰¥ 80%
 * - BRANCH â‰¥ 70%
 */
object CoveragePolicy {
  val line: BigDecimal get() = 0.80.toBigDecimal()
  val branch: BigDecimal get() = 0.70.toBigDecimal()
}

.....

// Jacoco ê¸°ë³¸ ì„¤ì •
jacoco {
  toolVersion = "0.8.11"
}

/**
 * ê³µí†µ exclude ê·œì¹™ (ì»¤ë²„ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì—ì„œ ì œì™¸í•  í´ë˜ìŠ¤ íŒ¨í„´)

 */
val excludedPatterns = listOf(
  "**/*ApplicationKt.class",    // main í•¨ìˆ˜ top-level í´ë˜ìŠ¤ (Kotlin)
  "**/*Application.class",      // SpringBootApplication í´ë˜ìŠ¤
  "**/*Dto.class",              // DTO í´ë˜ìŠ¤
  "**/*DtoKt.class",            // companion object ë“± í¬í•¨ëœ Kotlin Dto ê´€ë ¨
  "**/*Request.class",          // ìš”ì²­ìš© ê°ì²´
  "**/*Response.class",         // ì‘ë‹µìš© ê°ì²´
  "**/*Config.class",            // ì„¤ì • í´ë˜ìŠ¤
  "**/*Exception.class",        // ì˜ˆì™¸ í´ë˜ìŠ¤
  "**/*Constants.class",        // ìƒìˆ˜ í´ë˜ìŠ¤
  "**/*Interceptor.class",      // ì¸í„°ì…‰í„°
  "**/*Mapper.class",           // Mapper í´ë˜ìŠ¤
  "**/*Extensions.class",       // Kotlin í™•ì¥ í•¨ìˆ˜ ëª¨ìŒ
  "**/Q*.class"                 // QueryDSL Q í´ë˜ìŠ¤
)

val classDirsToAnalyze = fileTree("build/classes/kotlin/main").matching {
  exclude(excludedPatterns)
}

// ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€ ê²€ì¦ ì„¤ì • (JacocoViolation) - ì»¤ë²„ë¦¬ì§€ ë¯¸ë‹¬ ì‹œ ë¹Œë“œ ì‹¤íŒ¨
tasks.named<JacocoCoverageVerification>("jacocoTestCoverageVerification") {
  classDirectories.setFrom(files(classDirsToAnalyze))
  sourceDirectories.setFrom(files("src/main/kotlin"))
  executionData.setFrom(fileTree(layout.buildDirectory).include("/jacoco/test.exec"))

  violationRules {
    rule {
      enabled = true
      limit {
        counter = "LINE"
        value = "COVEREDRATIO"
        minimum = CoveragePolicy.line
      }
      limit {
        counter = "BRANCH"
        value = "COVEREDRATIO"
        minimum = CoveragePolicy.branch
      }
    }
  }
}

tasks.named<JacocoReport>("jacocoTestReport") {
  dependsOn(tasks.test)

  classDirectories.setFrom(files(classDirsToAnalyze))
  sourceDirectories.setFrom(files("src/main/kotlin"))
  executionData.setFrom(fileTree(layout.buildDirectory).include("/jacoco/test.exec"))

  reports {
    xml.required.set(true)
    html.required.set(true)
  }
}

// testCoverage: í…ŒìŠ¤íŠ¸ / ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ / ê²€ì¦ì„ í¬í•¨í•œ íƒœìŠ¤í¬
tasks.register("testCoverage") {
  group = "verification"
  description = "Run tests, generate report, verify coverage"
  dependsOn("test", "jacocoTestReport", "jacocoTestCoverageVerification")
}

// check íƒœìŠ¤í¬ì— í†µí•© (TODO: CIì—ì„œ ì‚¬ìš© ë  ê¸°ë³¸ íƒœìŠ¤í¬)
tasks.named("check") {
  dependsOn("testCoverage")
}


```

### ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ë³´ê¸°

```bash
  
$ ./gradlew clean build

$ open build/reports/jacoco/test/html/index.html
```
ì´ˆë¡ìƒ‰: ì»¤ë²„ëœ ì½”ë“œ  
ë¹¨ê°„ìƒ‰: ì»¤ë²„ë˜ì§€ ì•ŠìŒ  
ë…¸ë€ìƒ‰: ë¶„ê¸° ì¡°ê±´ ì¼ë¶€ë§Œ ì»¤ë²„ë¨


## Jacocoì˜ ë™ì‘ ë°©ì‹
JacocoëŠ” í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤

| ë‹¨ê³„        | ì„¤ëª…                                      |
|-----------| --------------------------------------- |
| 1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ | Jacoco Agentê°€ `.exec`ì— ì‹¤í–‰ ì´ë ¥ ê¸°ë¡         |
| 2. ë¦¬í¬íŠ¸ ìƒì„± | `.exec` + `.class`ë¥¼ ë§¤ì¹­í•´ ë¦¬í¬íŠ¸ ìƒì„±          |
| 3. ê¸°ì¤€ ê²€ì¦  | ì„¤ì •í•œ ê¸°ì¤€(LINE 80%, BRANCH 70%) ìœ„ë°˜ ì‹œ ë¹Œë“œ ì‹¤íŒ¨ |


1. `test` íƒœìŠ¤í¬ ì‹¤í–‰ ì‹œ, Jacoco Agentê°€ `.exec` íŒŒì¼ì— **"ì–´ë–¤ í´ë˜ìŠ¤ì˜ ì–´ë–¤ ë¼ì¸ì´ ì‹¤ì œ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€"** ê¸°ë¡í•œë‹¤.
2. ì´í›„ `jacocoTestReport` íƒœìŠ¤í¬ë¥¼ ì‹¤í–‰í•˜ë©´, JacocoëŠ” `.exec` íŒŒì¼ê³¼ ë¹Œë“œëœ `.class` íŒŒì¼ì„ **ì •í™•íˆ ë§¤ì¹­í•´ì„œ ë¦¬í¬íŠ¸**ë¥¼ ìƒì„±í•œë‹¤. 

ì¦‰, ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ëŠ” **ì‹¤í–‰ ê²°ê³¼(`.exec`) + ì‹¤í–‰ ì‹œì ì˜ ë°”ì´íŠ¸ì½”ë“œ(`.class`)** ì¡°í•©ìœ¼ë¡œ ìƒì„±ëœë‹¤.
`.exec`ëŠ” ë‹¨ìˆœ ì‹¤í–‰ ì´ë ¥ ë¡œê·¸ê°€ ì•„ë‹ˆë¼, **í´ë˜ìŠ¤ë³„ ì»¤ë²„ëœ ëª…ë ¹ì–´ ë‹¨ìœ„ ì •ë³´**ê°€ ë“¤ì–´ìˆëŠ” ë°”ì´ë„ˆë¦¬ íŒŒì¼ì´ë‹¤.

> í•˜ì§€ë§Œ ì´ ê³¼ì •ì€ **ë¹Œë“œ ìˆœì„œì— ë”°ë¼ ì‰½ê²Œ ê¹¨ì§ˆ ìˆ˜ ìˆë‹¤.**  
> `test` íƒœìŠ¤í¬ê°€ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë©´ `.exec` íŒŒì¼ì´ ìƒì„±ë˜ì§€ ì•Šì•„ ë¦¬í¬íŠ¸ ìƒì„± ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.  
> 
> Gradle + Jacocoì—ì„œ ì˜¬ë°”ë¥¸ ì‹¤í–‰ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.  
> test -> jacocoTestReport -> jacocoTestCoverageVerification